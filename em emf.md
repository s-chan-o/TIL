## 엔티티 매니저 (Entity Manager)

엔티티 매니저는 엔티티를 저장, 수정, 삭제, 조회 등 엔티티와 관련된 모든 일을 한다.

엔티티 매니저는 영속 컨텍스트에 접근하여 엔티티에 대한 DB 작업을 제공한다.

#### 엔티티 매니저의 메서드

> find() 메서드

find() 메서드는 영속 컨텍스트에서 엔티티를 검색하고 없을 경우 DB에서 데이터를 찾아 영속 컨텍스트에 저장한다. 여기서 식별자는 Entity 클래스에서 @Id 어노테이션으로 저장한 값을 사용해야 한다.

> persist() 메서드

persist() 메서드는 엔티티를 영속 컨텍스트에 저장 후 INSERT 쿼리를 실행한다. 보통 커밋시점에 INSERT 쿼리를 실행한다.

persist() 메서드는 트랜잭션 범위 내에서 실행해야 한다. persist() 메서드는 실행시점에 영속 컨텍스트에 엔티티를 저장하고, 트랜잭션을 커밋하는 시점에 INSERT 쿼리가 시작되기 때문에 트랜잭션 범위에서 실행하지 않으면 실제로 DB에 반영되지 않는다.

> remove() 메서드

remove() 메서드는 엔티티 클래스를 영속 컨텍스트에서 삭제 후 DELETE 쿼리를 실행한다.

remove() 메서드 역시 트랜잭션 범위 내에서 실행되어야 하며 트랜잭션이 커밋하는 시점에 DELETE 쿼리가 실행된다.

## 엔티티 매니저 팩토리 (Entity Manager Factory)

JPA를 사용하기 위해서는 먼저 엔티티 매니저 팩토리라는 객체를 생성해야 된다. 이 객체가 있어야 엔티티 매니저를 생성할 수 있기 때문이다. 즉, 엔티티 매니저 팩토리는 이름 그대로 엔티티 매니저를 찍어내는 공장같은 것이다.

> 엔티티 매니저 팩토리 생성

`코드`

`EntitManagerFactory emf = Persistence.createEntityManagerFactory("name");`

> 엔티티 매니저 생성

`코드`

`EntityManager em = emf.createEntityManager();`

> 엔티티 매니저와 엔티티 매니저 팩토리의 특징

엔티티 매니저

    - 생성 비용이 적다.
    - 여러 스레드가 동시에 접근하면 동시성 문제가 발생한다.
    - DB 커넥션풀에서 연결이 꼭 필요한 시점에 커넥션을 얻어 사용한다.

엔티티 매니저 팩토리

    - 엔티티 매니저 팩토리는 말그대로 엔티티 매니저를 만드는 공장이다
    - 생성 비용이 크다.
    - 한개만 만들어 어플리케이션 전체에서 공유하도록 설계되어 있다.

